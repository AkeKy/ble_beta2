# คู่มือการใช้งาน: ระบบติดตามตำแหน่ง BLE ภายในอาคาร

ยินดีต้อนรับสู่ระบบติดตามตำแหน่ง BLE ภายในอาคาร คู่มือนี้จะแนะนำคุณทีละขั้นตอน ตั้งแต่การติดตั้งจนถึงการติดตามแบบเรียลไทม์

## สารบัญ

1.  [สิ่งที่ต้องเตรียม](#1-สิ่งที่ต้องเตรียม)
2.  [การติดตั้ง](#2-การติดตั้ง)
3.  [การรัน Backend Server](#3-การรัน-backend-server)
4.  [ขั้นตอนที่ 1: ลงทะเบียน Gateway](#4-ขั้นตอนที่-1-ลงทะเบียน-gateway)
5.  [ขั้นตอนที่ 2: ติดตามตำแหน่งแบบเรียลไทม์](#5-ขั้นตอนที่-2-ติดตามตำแหน่งแบบเรียลไทม์)
6.  [ขั้นตอนที่ 3: ดูสถิติและข้อมูล](#6-ขั้นตอนที่-3-ดูสถิติและข้อมูล)
7.  [การแก้ปัญหา](#7-การแก้ปัญหา)

---

## 1. สิ่งที่ต้องเตรียม

ก่อนเริ่มใช้งาน กรุณาตรวจสอบว่าคุณมีสิ่งต่อไปนี้:

*   **Python 3.11 หรือใหม่กว่า**: ดาวน์โหลดได้จาก [python.org](https://www.python.org/downloads/)
*   **เชื่อมต่อเน็ตมหาวิทยาลัย**: คุณ**ต้อง**เชื่อมต่อกับเครือข่ายของมหาวิทยาลัย (ผ่าน WiFi หรือ VPN) เพื่อเข้าถึงเซิร์ฟเวอร์ EazyTrax ที่ `http://10.101.119.12:8001`
*   **BLE Tag**: BLE Tag เป้าหมาย (`C4D36AD87176`) ต้องเปิดใช้งานและอยู่ในระยะของ Gateway ของมหาวิทยาลัย
*   **เว็บเบราว์เซอร์**: เบราว์เซอร์สมัยใหม่ เช่น Chrome, Firefox หรือ Edge

---

## 2. การติดตั้ง

ขั้นตอนนี้จะติดตั้งไลบรารี Python ที่จำเป็นสำหรับ Backend Server

1.  **แตกไฟล์โปรเจค**: แตกไฟล์ `ble-trilateration.zip` ไปยังตำแหน่งที่คุณต้องการบนคอมพิวเตอร์

2.  **เปิด Terminal/Command Prompt**: ไปยังโฟลเดอร์ `backend` ของโปรเจค
    ```bash
    cd path/to/ble-trilateration/backend
    ```

3.  **ติดตั้ง Dependencies**: รันคำสั่งต่อไปนี้เพื่อติดตั้งแพ็คเกจ Python ที่จำเป็นทั้งหมด
    ```bash
    pip install -r requirements.txt
    ```
    คำสั่งนี้จะติดตั้ง Flask, Flask-SocketIO, requests และไลบรารีอื่นๆ ที่จำเป็น

---

## 3. การรัน Backend Server

Backend Server คือหัวใจของระบบ มันจัดการการดึงข้อมูล การคำนวณตำแหน่ง และการสื่อสารกับหน้าเว็บ

*   **เริ่มต้น Server**: ขณะที่อยู่ในโฟลเดอร์ `backend` รันคำสั่ง:
    ```bash
    python app.py
    ```

*   **ตรวจสอบ**: คุณควรเห็นข้อความแสดงว่า Server กำลังทำงาน คล้ายกับนี้:
    ```
    INFO:__main__:Starting BLE Trilateration Server...
    INFO:werkzeug: * Running on http://127.0.0.1:5000
    (Press CTRL+C to quit)
    ```

> **สำคัญ**: เปิดหน้าต่าง Terminal นี้ไว้ การปิดจะทำให้ Backend Server หยุดทำงาน

---

## 4. ขั้นตอนที่ 1: ลงทะเบียน Gateway

ก่อนที่คุณจะติดตาม Tag ได้ คุณต้องบอกระบบว่า Gateway อยู่ที่ไหน **นี่คือขั้นตอนที่สำคัญที่สุดสำหรับความแม่นยำ**

1.  **เปิดหน้าลงทะเบียน**: เปิดเว็บเบราว์เซอร์และไปที่:
    **[http://localhost:5000/gateway_registration.html](http://localhost:5000/gateway_registration.html)**

2.  **โหลดแผนผังชั้น**: ตรวจสอบให้แน่ใจว่ารูปแผนผังชั้น (เช่น `floor5.png`) อยู่ในโฟลเดอร์ `frontend/images/` หน้าเว็บจะพยายามโหลดรูปภาพสำหรับชั้นที่เลือกโดยอัตโนมัติ

3.  **ลงทะเบียนแต่ละ Gateway**:
    *   เลือก**ชั้น**ที่ถูกต้องจากเมนูดรอปดาวน์
    *   **คลิก**บนแผนที่ตรงตำแหน่งที่แน่นอนของ Gateway
    *   จะมีป๊อปอัพขึ้นมา ให้ใส่**MAC Address** ของ Gateway (เช่น `9C:8C:D8:C7:E0:16`)
    *   คลิก **"บันทึก Gateway"**
    *   เครื่องหมายสีเขียวของ Gateway จะปรากฏบนแผนที่

4.  **ทำซ้ำ**: ทำซ้ำขั้นตอนนี้สำหรับ**อย่างน้อย 3 Gateway** บนชั้นที่คุณต้องการติดตาม เพื่อผลลัพธ์ที่ดีที่สุด ควรลงทะเบียน Gateway ให้มากที่สุดเท่าที่จะทำได้ (แนะนำ 10-20 ตัว) และตรวจสอบให้แน่ใจว่ากระจายอยู่ทั่วพื้นที่

---

## 5. ขั้นตอนที่ 2: ติดตามตำแหน่งแบบเรียลไทม์

เมื่อลงทะเบียน Gateway เรียบร้อยแล้ว คุณสามารถเริ่มติดตาม BLE Tag ได้

1.  **เปิดหน้าติดตาม**: ในเบราว์เซอร์ ไปที่:
    **[http://localhost:5000/tracking.html](http://localhost:5000/tracking.html)**

2.  **เลือกชั้น**: เลือกชั้นที่คุณต้องการติดตามจากเมนูดรอปดาวน์

3.  **เริ่มติดตาม**: คลิกปุ่ม **"Start Tracking"**

4.  **ดูตำแหน่ง**: ระบบจะทำการ:
    *   ดึงข้อมูลจาก EazyTrax API
    *   คำนวณตำแหน่งของ Tag
    *   แสดงเครื่องหมายสีแดงบนแผนที่แทนตำแหน่งของ Tag
    *   แถบด้านข้างจะแสดง Gateway ที่ตรวจพบและความแรงของสัญญาณ

ตำแหน่งจะอัปเดตโดยอัตโนมัติทุกๆ ไม่กี่วินาที

---

## 6. ขั้นตอนที่ 3: ดูสถิติและข้อมูล

ระบบจะเก็บตำแหน่งที่คำนวณได้ทั้งหมดในฐานข้อมูล คุณสามารถดูข้อมูลย้อนหลังและการวิเคราะห์ในหน้าสถิติ

1.  **เปิดหน้าสถิติ**: ในเบราว์เซอร์ ไปที่:
    **[http://localhost:5000/statistics.html](http://localhost:5000/statistics.html)**

2.  **วิเคราะห์ข้อมูล**: หน้านี้มี:
    *   **การ์ดสรุป**: ตำแหน่งทั้งหมด ความแม่นยำเฉลี่ย ฯลฯ
    *   **กราฟ**: ไทม์ไลน์ตำแหน่ง การกระจายสัญญาณ Gateway และอื่นๆ
    *   **Heatmap**: การแสดงภาพว่า Tag อยู่ที่ไหนบ่อยที่สุด
    *   **ตารางประวัติ**: บันทึกตำแหน่งที่บันทึกไว้ทั้งหมดแบบแบ่งหน้า

ใช้ตัวกรองด้านบนเพื่อจำกัดข้อมูลตามชั้นและช่วงเวลา

---

## 7. การแก้ปัญหา

### ปัญหา: "Failed to fetch API data" หรือ Scraper แสดง 0 Gateway

**วิธีแก้**: ตรวจสอบให้แน่ใจว่าคุณเชื่อมต่อกับเครือข่ายของมหาวิทยาลัย เซิร์ฟเวอร์ EazyTrax ไม่สามารถเข้าถึงได้จากอินเทอร์เน็ตสาธารณะ

### ปัญหา: ข้อผิดพลาด "Not enough gateways" ระหว่างการติดตาม

**วิธีแก้**: คุณต้องมีอย่างน้อย 3 Gateway ที่กำลังตรวจจับ Tag *และ*ลงทะเบียนในระบบสำหรับชั้นที่เลือก กลับไปที่หน้าลงทะเบียน Gateway และเพิ่ม Gateway เพิ่มเติม

### ปัญหา: ตำแหน่งไม่แม่นยำหรือกระโดดไปมา

**วิธีแก้**: นี่เป็นเรื่องปกติสำหรับการกำหนดตำแหน่งที่ใช้ RSSI เพื่อปรับปรุงความแม่นยำ:
*   ลงทะเบียน Gateway เพิ่มเติม
*   ตรวจสอบให้แน่ใจว่าตำแหน่ง Gateway ที่คุณลงทะเบียนถูกต้อง
*   Kalman Filter ได้ถูกใช้งานแล้วเพื่อช่วยปรับตำแหน่งให้นุ่มนวล แต่ข้อมูล Gateway ที่แข็งแกร่งเป็นสิ่งสำคัญ

---

## สรุปขั้นตอนการใช้งาน

1. ✅ ติดตั้ง Python และ Dependencies
2. ✅ เชื่อมต่อเน็ตมหาวิทยาลัย
3. ✅ รัน Backend Server (`python app.py`)
4. ✅ ลงทะเบียน Gateway (อย่างน้อย 3 ตัว)
5. ✅ เริ่มติดตามตำแหน่งแบบเรียลไทม์
6. ✅ ดูสถิติและวิเคราะห์ข้อมูล

---

## หมายเหตุสำคัญ

> **การเชื่อมต่อเน็ตมหาวิทยาลัย**: ระบบจะทำงานได้ก็ต่อเมื่อคุณเชื่อมต่อกับเครือข่ายของมหาวิทยาลัยเท่านั้น เพราะเซิร์ฟเวอร์ EazyTrax อยู่ที่ IP Address ภายใน (`10.101.119.12`)

> **จำนวน Gateway**: ยิ่งลงทะเบียน Gateway มากเท่าไหร่ ความแม่นยำก็จะยิ่งสูงขึ้น แนะนำให้ลงทะเบียนอย่างน้อย 10-20 ตัวต่อชั้น

> **MAC Address ของ Tag**: ระบบถูกตั้งค่าให้ติดตาม Tag ที่มี MAC Address `C4D36AD87176` หากต้องการเปลี่ยน สามารถแก้ไขในไฟล์ `backend/web_scraper.py` และ `backend/app.py`

---

## ติดต่อและสนับสนุน

หากพบปัญหาหรือมีคำถาม กรุณาตรวจสอบส่วน "การแก้ปัญหา" ในคู่มือนี้ก่อน

พัฒนาโดย **Manus AI**  
สำหรับโปรเจค BLE Indoor Positioning System

